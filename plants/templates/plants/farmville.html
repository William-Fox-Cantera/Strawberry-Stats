{% extends 'plants/main.html' %}
{% load static %}
{% block content %}
{% include 'plants/status.html' %}

<style>
    .button {
        margin: 0;
        position: fixed;
        top: 33%;
        left: 5.8%;
        -ms-transform: translate(-50%, -50%);
        transform: translate(-50%, -50%);
        display: inline-block;
        border-radius: 4px;
        background-color: #f4511e;
        border: none;
        color: #FFFFFF;
        text-align: center;
        font-size: 28px;
        padding: 20px;
        width: 200px;
        transition: all 0.5s;
        cursor: pointer;
        margin: 5px;
    }

    .button span {
        cursor: pointer;
        display: inline-block;
        position: relative;
        transition: 0.5s;
    }

    .button span:after {
        content: '\00bb';
        position: absolute;
        opacity: 0;
        top: 0;
        right: -20px;
        transition: 0.5s;
    }

    .button:hover span {
        padding-right: 25px;
    }

    .button:hover span:after {
        opacity: 1;
        right: 0;
    }

    .card-body {
        width: 500px;
    }

    .view-button {
        top: 70%;
    }

    .instruction-box {
        border-style: solid;
        border-width: thick;
        border-color: #000000;
        position: fixed;
        left: .9%;
        top: 27.6%;
        margin-top: 6%;
    }

    #map {
        border-style: solid;
        border-width: thick;
        border-color: #000000;
        width: 80%;
        height: 60%;
        margin: 0; 
        position: absolute;  
        left: 19.5%; 
        top: 29%;
    }

    .marker {
        width: 200px;
        height: 200px;
        background-size: cover;
        display: block;
    }
</style>

<div>
    <a class="button" href="{% url 'csv_upload' False %}" style="vertical-align:middle"><span>Back</span></a>
</div>

<div class="instruction-box card" style="width: 20rem;">
    <div class="card-body" style="width: 400px">
      <h5 class="card-title" style="font-family: fantasy; font-size: 28px;">What Am I Looking At?</h5>
      <p class="card-text" style="font-size: 21px; max-width: 70%;">This is a map displaying your field. Zoom in with the scroll wheel
                           to get a better view of each strawberry icon. Each of these icons represents an actual 
                           on the ground location of a plant. Hover over them with the cursor to see more information,
                           like images, coordinates, and more.
      </p>
    </div>
</div>

<div id="map"></div> 

<script type="text/javascript">
mapboxgl.accessToken = 'pk.eyJ1Ijoid2lsbGlhbWZveCIsImEiOiJja2JzY3V0dTcwMGJ6MnZzYWF2cjRsNXYwIn0.fbOk4CcYFDOMA_nG9JCauA';


var coordinates = JSON.parse("{{coordinates}}");

var geojson = {
    'type': 'FeatureCollection',
    'features': [
        
    ]
};

for (let i = 0; i < coordinates.length; i++) {
    var feature = {
            'type': 'Feature',
            'properties': {
            'message': 'Hello',
            'iconSize': [60, 60],
            'image':'https://tric-static-bucket.s3.us-east-2.amazonaws.com/static/images/sampleBerry.png'
        },
        'geometry': {
            'type': 'Point',
            'coordinates': [coordinates[i][1], coordinates[i][0]]
        }
    }
    geojson['features'].push(feature);
}


var map = new mapboxgl.Map({
container: 'map',
    style: 'mapbox://styles/mapbox/streets-v11',
    center: [-75.596, 39.1122],
    zoom: 15
});

// add markers to map
geojson.features.forEach(function(marker) {
    // create a DOM element for the marker
    var el = document.createElement('div');
    el.className = 'marker';
    el.style.backgroundImage =
        'url(https://tric-static-bucket.s3.us-east-2.amazonaws.com/static/images/strawberry.png)';
    el.style.width = '30px';//marker.properties.iconSize[0] + 'px';
    el.style.height = '30px';//marker.properties.iconSize[1] + 'px';

    // add marker to map
    new mapboxgl.Marker(el)
    .setLngLat(marker.geometry.coordinates)
    .addTo(map);

    // Make popup, not added to map yet
    var popup = new mapboxgl.Popup({
        closeButton: false,
        closeOnClick: false
    })
    .setLngLat(marker.geometry.coordinates)
    //.setPopup(new mapboxgl.Popup({ offset: 25 }) // add popups
    .setHTML('<p><img src="' + marker.properties.image + '" style="min-height: 150; min-width: 150px;"></p>' // Add image to the popup
            + '<H4 style="background-color: green;">Plant Number: 12</H4>' 
            + '<H4 style="font-size: 14px;">Latitude:' + marker.geometry.coordinates[0] + '</H4>'
            + '<H4 style="font-size: 14px;">Longitude:' + marker.geometry.coordinates[1] + '</H4>'
            + '<H4 style="background-color: red;">Has Flowers? No</H4>'); 
   

    el.addEventListener('mouseenter', function() {
        map.getCanvas().style.cursor = 'pointer'; // Change cursor to indicate response
        popup
            .addTo(map);
    });

    el.addEventListener('mouseleave', function() {
        map.getCanvas().style.cursor = '';
        popup.remove();
    });
});
</script>

{% endblock content %}